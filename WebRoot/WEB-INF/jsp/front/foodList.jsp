<%@ page language="java" pageEncoding="utf-8"%>
<div style="display: none">
	<table id="#trig-bmBmsj-table"></table>
</div>
<div class="row">
	<div style="margin-top: 20px">
		<div style="width: 266px;height:220px;float: left;margin-left:8px" class="col-md-4">
			<img style="width: 266px;height: 88px" alt="" src="/uploadfiles/img/1519296712077-5600.jpg">
			<font style="font-size: 26px">宫保鸡丁</font><br>
			价格：¥26<br>
			数量<button class="minus-btn" disabled="" data-reactid="75">-</button><input type="text" class="input" value="1" data-reactid="76"><button class="plus-btn" data-reactid="77">+</button>
			<br><br>
			<button style="font-size: 13px">立即订购</button>
		</div>
		<div style="width: 266px;height:220px;float: left;margin-left:8px" class="col-md-4">
			<img style="width: 266px;height: 88px" alt="" src="/uploadfiles/img/1519296712077-5600.jpg">
			<font style="font-size: 26px">宫保鸡丁</font><br>
			价格：¥26<br>
			数量<button class="minus-btn" disabled="" data-reactid="75">-</button><input type="text" class="input" value="1" data-reactid="76"><button class="plus-btn" data-reactid="77">+</button>
			<br><br>
			<button style="font-size: 13px">立即订购</button>
		</div>
		<div style="width: 266px;height:220px;float: left;margin-left:8px" class="col-md-4">
			<img style="width: 266px;height: 88px" alt="" src="/uploadfiles/img/1519296712077-5600.jpg">
			<font style="font-size: 26px">宫保鸡丁</font><br>
			价格：¥26<br>
			数量<button class="minus-btn" disabled="" data-reactid="75">-</button><input type="text" class="input" value="1" data-reactid="76"><button class="plus-btn" data-reactid="77">+</button>
			<br><br>
			<button style="font-size: 13px">立即订购</button>
		</div>
		<div style="width: 266px;height:220px;float: left;margin-left:8px" class="col-md-4">
			<img style="width: 266px;height: 88px" alt="" src="/uploadfiles/img/1519296712077-5600.jpg">
			<font style="font-size: 26px">宫保鸡丁</font><br>
			价格：¥26<br>
			数量<button class="minus-btn" disabled="" data-reactid="75">-</button><input type="text" class="input" value="1" data-reactid="76"><button class="plus-btn" data-reactid="77">+</button>
			<br><br>
			<button style="font-size: 13px">立即订购</button>
		</div>
		<div style="width: 266px;height:220px;float: left;margin-left:8px" class="col-md-4">
			<img style="width: 266px;height: 88px" alt="" src="/uploadfiles/img/1519296712077-5600.jpg">
			<font style="font-size: 26px">宫保鸡丁</font><br>
			价格：¥26<br>
			数量<button class="minus-btn" disabled="" data-reactid="75">-</button><input type="text" class="input" value="1" data-reactid="76"><button class="plus-btn" data-reactid="77">+</button>
			<br><br>
			<button style="font-size: 13px">立即订购</button>
		</div>
		<div style="width: 266px;height:220px;float: left;margin-left:8px" class="col-md-4">
			<img style="width: 266px;height: 88px" alt="" src="/uploadfiles/img/1519296712077-5600.jpg">
			<font style="font-size: 26px">宫保鸡丁</font><br>
			价格：¥26<br>
			数量<button class="minus-btn" disabled="" data-reactid="75">-</button><input type="text" class="input" value="1" data-reactid="76"><button class="plus-btn" data-reactid="77">+</button>
			<br><br>
			<button style="font-size: 13px">立即订购</button>
		</div>
		<div style="width: 266px;height:220px;float: left;margin-left:8px" class="col-md-4">
			<img style="width: 266px;height: 88px" alt="" src="/uploadfiles/img/1519296712077-5600.jpg">
			<font style="font-size: 26px">宫保鸡丁</font><br>
			价格：¥26<br>
			数量<button class="minus-btn" disabled="" data-reactid="75">-</button><input type="text" class="input" value="1" data-reactid="76"><button class="plus-btn" data-reactid="77">+</button>
			<br><br>
			<button style="font-size: 13px">立即订购</button>
		</div>
		<div style="width: 266px;height:220px;float: left;margin-left:8px" class="col-md-4">
			<img style="width: 266px;height: 88px" alt="" src="/uploadfiles/img/1519296712077-5600.jpg">
			<font style="font-size: 26px">宫保鸡丁</font><br>
			价格：¥26<br>
			数量<button class="minus-btn" disabled="" data-reactid="75">-</button><input type="text" class="input" value="1" data-reactid="76"><button class="plus-btn" data-reactid="77">+</button>
			<br><br>
			<button style="font-size: 13px">立即订购</button>
		</div>
		<div style="width: 266px;height:220px;float: left;margin-left:8px" class="col-md-4">
			<img style="width: 266px;height: 88px" alt="" src="/uploadfiles/img/1519296712077-5600.jpg">
			<font style="font-size: 26px">宫保鸡丁</font><br>
			价格：¥26<br>
			数量<button class="minus-btn" disabled="" data-reactid="75">-</button><input type="text" class="input" value="1" data-reactid="76"><button class="plus-btn" data-reactid="77">+</button>
			<br><br>
			<button style="font-size: 13px">立即订购</button>
		</div>
	</div>
	
</div>
<div style="display: none">
	<div id="spmodal" style="width: 33%;height:99px;float: left;" class="col-md-4">
		<img name="foodImg" style="width: 100%;height: 100%" alt="" src="https://www.baidu.com/img/bd_logo1.png">
		<span name="foodName"></span>
		<span name="foodPrice"></span>
	</div>
</div>
<div class="trig-bottom"></div>

<script>
var url = {};
var ttable = null;
var tablerows = [];
$(function(){
	TRIG.LOADHTMLOrJs(function(){
		//时间bootstrap-timepicker.js (5 matches)
// 		$(".datetimepicker").datetimepicker(); // 日期+时分秒  
		//对象定义
		var bmBmsj = function () {
				// 访问URL定义
				url = {
						add : 'sys/manager_addFood.action',
						update : 'sys/manager_updateFood.action',
						del : 'sys/manager_delFood.action',
						find : 'sys/manager_findFoodManegePageList.action',
				};
				// 变量定义
				// 列表数据
				// 表格
				var table = $('#trig-bmBmsj-table');
			    
				// 列表初始
				var tableInit = function() {
					ttable = new TRIG.Datatable({
				    		table : table, 
				    		url : url.find, 
				    		columns : [
				    				  	{
				    				   		"data": null, 
				    				   		"render": function(data, type, row, mete){
				    					   		tablerows[row.id] = row;
				    							return '<input name="kssjts" type="checkbox" class="checkboxes" value="'+row.id+'"/>'; 
				    							//TODO 这里是ID列，这里修改...  
				    				   		}, 
				    				   		orderable: false, 
				    				   		className: "trig-checkbox" 
				    				   	}
				    		            
				    		],
				    		//TODO 这里设置排序列，从0开始。。。
	    					order: [[1,'dscri']],
	    					drawCallback : function() {
	    						for(var i in tablerows){
					    			var c = $("#spmodal").clone;
	    							c.find("[name='foodImg']").attr("src",tablerows[i].pic);
	    							c.find("[name='foodName']").html(tablerows[i].name);
	    							c.find("[name='foodPrice']").html(tablerows[i].price);
	    						}
				    		}
				    });
					
					// 显示更多字段值
				};
				
				return {
					// 查询
					query : function() {
						ttable.query(TRIG.DataDeal.form2TTableQueryParams("trig-search-form"));
					},
					init : function() {
						tableInit();
					},
					getTable : function() {
						return ttable;
					},
					getTableRows : function() {
						return tablerows;
					}
				};
		}(); // 定义并执行
		// 执行初始
	    bmBmsj.init();
	    /**
	     * 功能按钮事件绑定
	     */
	    // 查询
	    $("#findBmBmsj").bind('click', function() {
	    	bmBmsj.query();
		});
		// 新增
	    $("#addUser").bind('click', function(){
	    	$("#editForm")[0].reset(); 
	    	$("#editModal").modal("show");
	    });
	    // 修改
	    $("#updateUser").bind('click', function(){
	    	var ids = ttable.getCheckbox();
			var rows = ids.size();
			// 是否选择单条记录
			if(rows == 1) {
				var id = ids.get(0).value;
				var data = tablerows[id];
				// 初始表单数据
				$("#food_id").val(data.id);
				$("#name").val(data.name);
				$("#price").val(data.price);
				$("#pic").val(data.pic);
				$("#img1").attr("src",data.pic);
				$("#dscri").val(data.dscri);
				$("#editModal").modal('show');
			}else{
				alert("请选择一条数据");
			}
	    });
	    // 删除
	    $("#deleteUser").bind('click', function(){
	    	var objs = ttable.getCheckbox();
			var rows = objs.size();
			if(rows >= 1) {
				var ids = "";
				objs.each(function(){
					ids += this.value + ",";
				}); 
				TRIG.trackPost(url.del, "ids=" + ids, function(data){
					if(data.success){
						ttable.reload();
					}
					alert(data.message);
				});
			}else{
				alert("请选择一条数据");
			}
	    });
	    $("#submitFood").bind('click', function(){
	    	var arr = ["name","price","type","pic","dscri","file_path"];
	    	if(!checkNull(arr)){
	    		alert("请将表单必填项填写完整");
	    		return false;
	    	}
	    	var _url = url.add;
	    	if($("#food_id").val()){
	    		_url = url.update;
	    	}
	    	console.info($("#editForm").serialize());
	    	$.post(_url,$("#editForm").serialize(),function(data){
	    		if(data.success){
	    			$("#editModal").modal("hide");
	    			ttable.reload();
	    		}
	    		alert(data.message);
	    	},"json")
	    });
    });
});
</script>